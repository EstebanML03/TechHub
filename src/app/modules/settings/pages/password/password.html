<div class="password-wrapper">
  <div class="password-container">
    <!-- Header -->
    <div class="page-header">
      <button class="btn-back" (click)="volver()">
        <lucide-icon name="arrow-left"></lucide-icon>
      </button>
      <div class="header-content">
        <lucide-icon name="lock" class="header-icon"></lucide-icon>
        <div>
          <h1 class="page-title">Cambiar Contraseña</h1>
          <p class="page-subtitle">Mantén tu cuenta segura actualizando tu contraseña regularmente</p>
        </div>
      </div>
    </div>

    <div class="content-grid">
      <!-- Formulario -->
      <div class="form-section">
        <form [formGroup]="passwordForm" (ngSubmit)="cambiarPassword()">
          <!-- Contraseña Actual -->
          <div class="form-group">
            <label class="form-label">
              <lucide-icon name="key"></lucide-icon>
              <span>Contraseña actual</span>
            </label>
            <div class="input-wrapper" [class.error]="hasError('passwordActual')">
              <lucide-icon name="lock" class="input-icon"></lucide-icon>
              <input
                [type]="mostrarPasswordActual ? 'text' : 'password'"
                formControlName="passwordActual"
                placeholder="Ingresa tu contraseña actual"
                class="form-input"
              >
              <button
                type="button"
                class="toggle-password"
                (click)="togglePassword('actual')"
              >
                <lucide-icon [name]="mostrarPasswordActual ? 'eye-off' : 'eye'"></lucide-icon>
              </button>
            </div>
            @if (hasError('passwordActual')) {
              <span class="error-message">
                <lucide-icon name="alert-circle"></lucide-icon>
                {{getErrorMessage('passwordActual')}}
              </span>
            }
          </div>

          <!-- Contraseña Nueva -->
          <div class="form-group">
            <label class="form-label">
              <lucide-icon name="shield"></lucide-icon>
              <span>Nueva contraseña</span>
            </label>
            <div class="input-wrapper" [class.error]="hasError('passwordNueva')">
              <lucide-icon name="lock" class="input-icon"></lucide-icon>
              <input
                [type]="mostrarPasswordNueva ? 'text' : 'password'"
                formControlName="passwordNueva"
                placeholder="Ingresa tu nueva contraseña"
                class="form-input"
              >
              <button
                type="button"
                class="toggle-password"
                (click)="togglePassword('nueva')"
              >
                <lucide-icon [name]="mostrarPasswordNueva ? 'eye-off' : 'eye'"></lucide-icon>
              </button>
            </div>
            @if (hasError('passwordNueva')) {
              <span class="error-message">
                <lucide-icon name="alert-circle"></lucide-icon>
                {{getErrorMessage('passwordNueva')}}
              </span>
            }

            <!-- Fortaleza de Contraseña -->
            @if (passwordForm.get('passwordNueva')?.value) {
              <div class="password-strength">
                <div class="strength-bar">
                  <div
                    class="strength-fill strength-{{fortaleza.color}}"
                    [style.width.%]="fortaleza.porcentaje"
                  ></div>
                </div>
                <span class="strength-text strength-text-{{fortaleza.color}}">
                  {{fortaleza.texto}}
                </span>
              </div>
            }
          </div>

          <!-- Confirmar Contraseña -->
          <div class="form-group">
            <label class="form-label">
              <lucide-icon name="check-circle"></lucide-icon>
              <span>Confirmar contraseña</span>
            </label>
            <div class="input-wrapper" [class.error]="hasError('passwordConfirmar')">
              <lucide-icon name="lock" class="input-icon"></lucide-icon>
              <input
                [type]="mostrarPasswordConfirmar ? 'text' : 'password'"
                formControlName="passwordConfirmar"
                placeholder="Confirma tu nueva contraseña"
                class="form-input"
              >
              <button
                type="button"
                class="toggle-password"
                (click)="togglePassword('confirmar')"
              >
                <lucide-icon [name]="mostrarPasswordConfirmar ? 'eye-off' : 'eye'"></lucide-icon>
              </button>
            </div>
            @if (hasError('passwordConfirmar')) {
              <span class="error-message">
                <lucide-icon name="alert-circle"></lucide-icon>
                {{getErrorMessage('passwordConfirmar')}}
              </span>
            }
          </div>

          <!-- Generar Contraseña -->
          <button
            type="button"
            class="btn-generate"
            (click)="generarPasswordSegura()"
          >
            <lucide-icon name="sparkles"></lucide-icon>
            <span>Generar contraseña segura</span>
          </button>

          <!-- Botón Guardar -->
          <button
            type="submit"
            class="btn-submit"
            [disabled]="cargando || passwordForm.invalid"
          >
            @if (cargando) {
              <div class="spinner"></div>
            } @else {
              <lucide-icon name="save"></lucide-icon>
            }
            <span>Cambiar contraseña</span>
          </button>
        </form>
      </div>

      <!-- Requisitos de Seguridad -->
      <div class="info-section">
        <div class="requirements-card">
          <div class="card-header">
            <lucide-icon name="shield-check"></lucide-icon>
            <h3>Requisitos de seguridad</h3>
          </div>

          <ul class="requirements-list">
            @for (requisito of requisitos; track requisito.label) {
              <li class="requirement-item" [class.valido]="requisito.valido">
                <div class="requirement-icon">
                  @if (requisito.valido) {
                    <lucide-icon name="check-circle"></lucide-icon>
                  } @else {
                    <lucide-icon name="circle"></lucide-icon>
                  }
                </div>
                <span>{{requisito.label}}</span>
              </li>
            }
          </ul>

          @if (todosRequisitosValidos()) {
            <div class="success-badge">
              <lucide-icon name="shield-check"></lucide-icon>
              <span>Contraseña segura</span>
            </div>
          }
        </div>

        <!-- Consejos de Seguridad -->
        <div class="tips-card">
          <div class="card-header">
            <lucide-icon name="lightbulb"></lucide-icon>
            <h3>Consejos de seguridad</h3>
          </div>

          <ul class="tips-list">
            <li>
              <lucide-icon name="check"></lucide-icon>
              <span>Usa una contraseña única para cada cuenta</span>
            </li>
            <li>
              <lucide-icon name="check"></lucide-icon>
              <span>Actualiza tu contraseña regularmente</span>
            </li>
            <li>
              <lucide-icon name="check"></lucide-icon>
              <span>No compartas tu contraseña con nadie</span>
            </li>
            <li>
              <lucide-icon name="check"></lucide-icon>
              <span>Usa un gestor de contraseñas confiable</span>
            </li>
            <li>
              <lucide-icon name="check"></lucide-icon>
              <span>Activa la autenticación de dos factores</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
